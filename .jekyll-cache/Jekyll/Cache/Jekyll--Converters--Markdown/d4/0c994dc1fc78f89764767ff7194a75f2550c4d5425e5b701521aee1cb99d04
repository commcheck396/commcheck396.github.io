I"ğN<blockquote>
  <h3 id="æœ¬åŠŸèƒ½åˆ©ç”¨pythonè¯­è¨€åŸºäºnumpyåº“å®ç°">æœ¬åŠŸèƒ½åˆ©ç”¨Pythonè¯­è¨€ï¼ŒåŸºäºnumpyåº“å®ç°</h3>
</blockquote>

<p><br />
åˆ©ç”¨è’™ç‰¹å¡æ´›æ ‘æœç´¢å®ç°äº”å­æ£‹æ¸¸æˆå¯ä»¥è¯´æ˜¯ä¸€ä¸ªæ·±åº¦å­¦ä¹ å…¥é—¨é¡¹ç›®ï¼Œä¹Ÿç®—æ˜¯æˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦æ·±åº¦å­¦ä¹ é¢†åŸŸçš„é¡¹ç›®ï¼Œè¿‡ç¨‹è¿˜ç®—â€œæ¯”è¾ƒâ€é¡ºåˆ©ï¼Œä½†æ˜¯éš¾åº¦ä¸Šè¿˜æ˜¯è¦æ¯”ä¹‹å‰åšè¿‡çš„åˆ©ç”¨Q-learningå®ç°è¿·å®«å¯»è·¯è¦ä¸Šäº†ä¸€ä¸ªå°é˜¶ã€‚<br />
è¿™ç¯‡åšå®¢ä¸»è¦äcommcheck396.github.io¡Œæ£‹åŠ¨ä½commcheck396.github.io/blogç‰¹å¡æ´›æ ‘æœç´¢ç®—æ³•çš„ä»‹ç»ç•™åˆ°<a href="https://commcheck396.github.io/2022/01/21/MCTS2.html">ä¸‹ä¸€ç¯‡åšå®¢</a>å§ã€‚</p>

<p><br /></p>
<h2 id="äº”å­æ£‹æ£‹å±€ç¯å¢ƒçš„æ­å»º">äº”å­æ£‹æ£‹å±€ç¯å¢ƒçš„æ­å»º</h2>

<p>åˆ›å»ºä¸€ä¸ªæ£‹ç›˜ç±»<code class="language-plaintext highlighter-rouge">Class Board</code>ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ“ä½œæ£‹å­ï¼Œä¿®æ”¹æ£‹ç›˜æ ¼å±€ã€‚<br /><br />
æ­¤ç±»çš„åŸºæœ¬å±æ€§åŒ…æ‹¬ï¼š<br />
æ£‹ç›˜çš„å®½/é•¿åº¦<code class="language-plaintext highlighter-rouge">size</code>ï¼Œ<br />
æ£‹ç›˜çš„åˆç›˜<code class="language-plaintext highlighter-rouge">board</code>ï¼Œ<br />
å½“å‰ç©å®¶<code class="language-plaintext highlighter-rouge">cur_player</code>ï¼Œ<br />
å±æ€§åˆå§‹åŒ–ä»£ç å¦‚ä¸‹ï¼š<br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">board</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">cur_player</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">board</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="p">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">size</span><span class="p">),</span> <span class="nb">int</span><span class="p">)</span> <span class="k">if</span> <span class="n">board</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">board</span>     <span class="c1"># æ£‹ç›˜åˆå§‹çŠ¶æ€ï¼Œè‹¥æœªä¼ å…¥åˆç›˜åˆ™å½“ä½œç©ºæ£‹ç›˜å¤„ç†
</span>    <span class="bp">self</span><span class="p">.</span><span class="n">cur_player</span> <span class="o">=</span> <span class="n">cur_player</span>   <span class="c1">#-1ä»£è¡¨é»‘å­ï¼Œ1ä»£è¡¨ç™½å­
</span></code></pre></div></div>
<p><br />
åˆ›å»ºä¸€ä¸ªç©å®¶ç±»<code class="language-plaintext highlighter-rouge">Human</code>,æ–¹ä¾¿æˆ‘ä»¬è¯»å–è½å­ä½ç½®ï¼Œå¾—åˆ°ç”¨æˆ·è½å­åæ£‹ç›˜æ ¼å±€ã€‚<br />
æ­¤ç±»çš„åŸºæœ¬å±æ€§ä¸ºå½“å‰ç©å®¶<code class="language-plaintext highlighter-rouge">player</code>åˆå§‹åŒ–ä¸ºé»‘å­-1ï¼Œå±æ€§åˆå§‹åŒ–ä»£ç å¦‚ä¸‹ï¼š  <br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">player</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">player</span>
</code></pre></div></div>

<p>è¿™äº›ç¯å¢ƒç±»ä¸‹æœ‰æ“ä½œæ£‹ç›˜ï¼Œä¿®æ”¹æ ¼å±€çš„å¤šç§åŠŸèƒ½ï¼Œåˆ†åˆ«æ˜¯ï¼š  <br />
<code class="language-plaintext highlighter-rouge">is_move_legal(self, move_pos)</code>ï¼šåˆ¤æ–­å½“å‰åŠ¨ä½œåœ¨å½“å‰æ£‹ç›˜ä¸‹æ˜¯å¦åˆæ³•ã€‚<br />
<code class="language-plaintext highlighter-rouge">get_legal_pos(self)</code>ï¼šè·å–å½“å‰æ£‹ç›˜å†…æ‰€æœ‰å¯è¡Œæ£‹çš„ä½ç½®ã€‚<br />
<code class="language-plaintext highlighter-rouge">move(self, move_pos)</code>ï¼šæŒ‰ç…§move_posçš„ä½ç½®ä¿®æ”¹å½“å‰æ£‹ç›˜æ ¼å±€ï¼Œå³åœ¨move_posä½ç½®ä¸Šæ”¾ç½®å½“å‰ç©å®¶çš„æ£‹å­ã€‚<br />
<code class="language-plaintext highlighter-rouge">board_result(self, move_pos)</code>ï¼šåˆ¤æ–­å½“å‰æ£‹ç›˜åœ¨å½“å‰åŠ¨ä½œä¸‹æ˜¯å¦äº§ç”Ÿè¾“èµ¢æˆ–å¹³çš„å±€é¢ã€‚<br />
<code class="language-plaintext highlighter-rouge">game_over(self, move_pos)</code>ï¼šåˆ¤æ–­å½“å‰æ¸¸æˆæ˜¯å¦ç»“æŸï¼Œè¾“èµ¢æ–¹åˆ†åˆ«æ˜¯è°ï¼Œæˆ–æ˜¯å¦äº§ç”Ÿå¹³å±€å±€é¢ã€‚<br />
<code class="language-plaintext highlighter-rouge">get_action_pos(self, board)</code>ï¼šè¯»å–ç”¨æˆ·è¾“å…¥çš„è½å­ä½ç½®ã€‚<br />
<code class="language-plaintext highlighter-rouge">action(self, board)</code>ï¼šè·å¾—ç”¨æˆ·è½å­åçš„æ£‹ç›˜æ ¼å±€ã€‚<br /></p>

<p><br />
ç›¸åº”ä»£ç å¦‚ä¸‹ï¼š<br /><br /></p>

<p><code class="language-plaintext highlighter-rouge">is_move_legal(self, move_pos)</code>ï¼šåˆ¤æ–­å½“å‰åŠ¨ä½œåœ¨å½“å‰æ£‹ç›˜ä¸‹æ˜¯å¦åˆæ³•ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">is_move_legal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">move_pos</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">move_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">move_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">.</span><span class="n">size</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">.</span><span class="n">size</span><span class="p">:</span> <span class="c1">#åˆ¤æ–­æ˜¯å¦æº¢å‡ºæ£‹ç›˜è¾¹ç•Œ
</span>        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">board</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>   <span class="c1">#åˆ¤æ–­æ˜¯å¦ä¸‹åœ¨å·²ç»æœ‰æ£‹å­çš„ä½ç½®ä¸Š
</span>        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">get_legal_pos(self)</code>ï¼šè·å–å½“å‰æ£‹ç›˜å†…æ‰€æœ‰å¯è¡Œæ£‹çš„ä½ç½®ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_legal_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">board</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>   <span class="c1">#æ‰¾åˆ°æ£‹ç›˜ä¸Šæœªè½å­çš„ä½ç½®
</span>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="c1">#å°è£…æˆäºŒå…ƒç»„
</span></code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">move(self, move_pos)</code>ï¼šæŒ‰ç…§move_posçš„ä½ç½®ä¿®æ”¹å½“å‰æ£‹ç›˜æ ¼å±€ï¼Œå³åœ¨move_posä½ç½®ä¸Šæ”¾ç½®å½“å‰ç©å®¶çš„æ£‹å­</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">move_pos</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">is_move_legal</span><span class="p">(</span><span class="n">move_pos</span><span class="p">):</span> 
        <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"move {0} on board {1} is not legal"</span><span class="p">.</span> <span class="nb">format</span><span class="p">(</span><span class="n">move_pos</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">board</span><span class="p">))</span>
    <span class="n">new_board</span> <span class="o">=</span> <span class="n">Board</span><span class="p">(</span><span class="n">board</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">board</span><span class="p">),</span> <span class="n">cur_player</span><span class="o">=-</span><span class="bp">self</span><span class="p">.</span><span class="n">cur_player</span><span class="p">)</span>
    <span class="n">new_board</span><span class="p">.</span><span class="n">board</span><span class="p">[</span><span class="n">move_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">move_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">cur_player</span>
    <span class="k">return</span> <span class="n">new_board</span> 
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">board_result(self, move_pos)</code>ï¼šåˆ¤æ–­å½“å‰æ£‹ç›˜åœ¨å½“å‰åŠ¨ä½œä¸‹æ˜¯å¦äº§ç”Ÿè¾“èµ¢æˆ–å¹³çš„å±€é¢ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">board_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">move_pos</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">move_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">move_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">player</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">board</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([[</span><span class="bp">self</span><span class="p">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">size</span><span class="p">)]])</span>
    <span class="n">direction</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="p">.</span><span class="n">board</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">size</span><span class="p">)])</span>
    <span class="n">direction</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">board</span><span class="p">.</span><span class="n">diagonal</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="p">))</span>
    <span class="n">direction</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">fliplr</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">board</span><span class="p">).</span><span class="n">diagonal</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">v_list</span> <span class="ow">in</span> <span class="n">direction</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">v_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">player</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="n">num_in_a_row_will_win</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="bp">False</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">game_over(self, move_pos)</code>ï¼šåˆ¤æ–­å½“å‰æ¸¸æˆæ˜¯å¦ç»“æŸï¼Œè¾“èµ¢æ–¹åˆ†åˆ«æ˜¯è°ï¼Œæˆ–æ˜¯å¦äº§ç”Ÿå¹³å±€å±€é¢ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">game_over</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">move_pos</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">board_result</span><span class="p">(</span><span class="n">move_pos</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">'win'</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">get_legal_pos</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">'tie'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">get_action_pos(self, board)</code>ï¼šè¯»å–ç”¨æˆ·è¾“å…¥çš„è½å­ä½ç½®ã€‚</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_action_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">board</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">location</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Your move(please use commas to separate the two index): "</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">location</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  
            <span class="n">move_pos</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">location</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">)])</span>     <span class="c1"># æå–å‡ºç”¨æˆ·è¾“å…¥çš„ä½ç½®ä¿¡æ¯å¹¶å°è£…
</span>        <span class="k">else</span><span class="p">:</span>
            <span class="n">move_pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">move_pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">if</span> <span class="n">move_pos</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">move_pos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">board</span><span class="p">.</span><span class="n">get_legal_pos</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Invalid Move"</span><span class="p">)</span>
        <span class="n">move_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_action_pos</span><span class="p">(</span><span class="n">board</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">move_pos</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">action(self, board)</code>ï¼šè·å¾—ç”¨æˆ·è½å­åçš„æ£‹ç›˜æ ¼å±€ã€‚</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">board</span><span class="p">):</span>
    <span class="n">move_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_action_pos</span><span class="p">(</span><span class="n">board</span><span class="p">)</span>
    <span class="n">board</span> <span class="o">=</span> <span class="n">board</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">move_pos</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">board</span><span class="p">,</span> <span class="n">move_pos</span>
</code></pre></div></div>

<p><br /><br /><br /></p>
<h3 id="å·®ä¸å¤šå°±è¿™ä¹ˆå¤šäº†">å·®ä¸å¤šå°±è¿™ä¹ˆå¤šäº†</h3>
<p>å°†ä¸Šè¿°ç®€å•åŠ¨ä½œç»„åˆåœ¨ä¸€commcheck396.github.ioä»¥å®ç°äº”å­æ£‹çš„åŸºæœ¬åŠŸèƒ½äº†ï¼commcheck396.github.io/blogå…‰èšç„¦åˆ°å¦‚ä½•åˆ©ç”¨è’™ç‰¹å¡æ´›æ ‘æœç´¢è®­ç»ƒæ¨¡å‹å¹¶æ­å»ºèµ·äººæœºæ¸¸æˆçš„æ¨¡å‹ä¸Šï¼Œè¿™äº›å†…å®¹å°†æ”¾åœ¨æˆ‘çš„<a href="https://commcheck396.github.io/2022/01/21/MCTS2.html">ä¸‹ä¸€ç¯‡åšå®¢ä¸­</a>ã€‚</p>
:ET