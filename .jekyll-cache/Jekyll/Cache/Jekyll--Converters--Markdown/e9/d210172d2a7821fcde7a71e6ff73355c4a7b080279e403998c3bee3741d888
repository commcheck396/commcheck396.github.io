I"E<blockquote>
  <p>æœ¬åŠŸèƒ½åˆ©ç”¨Pythonè¯­è¨€ï¼ŒåŸºäºnumpyåº“å®ç°</p>
</blockquote>

<h2 id="è’™ç‰¹å¡æ´›æ ‘æœç´¢">è’™ç‰¹å¡æ´›æ ‘æœç´¢</h2>

<p>è¦åˆ©ç”¨è’™ç‰¹å¡æ´›æ ‘å¯¹å¯¹äº”å­æ£‹æ£‹å±€è¿›è¡Œæœç´¢ï¼Œé¦–å…ˆè¦äº†è§£è’™ç‰¹å¡æ´›æ ‘æœç´¢çš„è¿‡ç¨‹ã€‚  <br />
ä¸€èˆ¬æ¥è¯´ï¼Œè’™ç‰¹å¡æ´›æ ‘çš„æœç´¢è¿‡ç¨‹åˆ†ä¸ºå››æ­¥ï¼Œåˆ†åˆ«æ˜¯é€‰æ‹©ï¼ˆSelectionï¼‰ï¼Œæ‰©å±•ï¼ˆExpansionï¼‰ï¼Œä»¿çœŸï¼ˆSimulationï¼‰å’Œåå‘ä¼ æ’­ï¼ˆBackpropagationï¼‰ï¼Œè¦èƒ½è®©è¿™äº›æ“ä½œé¡ºåˆ©åœ°è¿è½¬èµ·æ¥ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ä¸€ä¸ªæ ‘å½¢æ•°æ®ç»“æ„ï¼Œå§‘ä¸”å«å®ƒæ¸¸æˆæ ‘ã€‚<br />
è¦å®ç°æ ‘å½¢ç»“æ„ï¼Œé¦–å…ˆè¦å®šä¹‰èŠ‚ç‚¹çš„æ•°æ®ç»“æ„ï¼Œæ–°å»ºä¸€ä¸ªèŠ‚ç‚¹ç±»å‹<code class="language-plaintext highlighter-rouge">Class Node</code>ï¼Œä»£è¡¨ä¸€ä¸ªæ£‹ç›˜æ ¼å±€ï¼Œå…¶å±æ€§åˆ†åˆ«æœ‰:<br />
<code class="language-plaintext highlighter-rouge">board</code>æ£‹ç›˜æ ¼å±€ï¼Œ<br />
<code class="language-plaintext highlighter-rouge">pre_pos</code>æœ€åä¸€æ¬¡è½å­çš„ä½ç½®ï¼Œ<br />
<code class="language-plaintext highlighter-rouge">parent</code>çˆ¶èŠ‚ç‚¹ï¼Œ<br />
<code class="language-plaintext highlighter-rouge">children</code>æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼Œ<br />
<code class="language-plaintext highlighter-rouge">not_vistit_pos</code>æœªè®¿é—®çš„ç»“ç‚¹ï¼Œ<br />
<code class="language-plaintext highlighter-rouge">num_visit</code>è¯¥èŠ‚ç‚¹è¢«è®¿é—®çš„æ¬¡æ•°ï¼Œ<br />
<code class="language-plaintext highlighter-rouge">num_of_wins</code>è¯¥èŠ‚ç‚¹ä»¿çœŸè¿‡ç¨‹ä¸­é»‘å­å’Œç™½å­çš„èƒœåˆ©æ¬¡æ•°ï¼Œ<br />
å±æ€§å®šä¹‰ä»¥åŠåˆå§‹åŒ–å¦‚ä¸‹ï¼š<br /></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def __init__(self, parent=None, pre_pos=None, board=None):
    self.pre_pos = pre_pos 
    self.parent = parent  
    self.children = list()
    self.not_visit_pos = None
    self.board = board
    self.num_of_visit = 0 
    self.num_of_wins = defaultdict(int)     # è®°å½•è¯¥ç»“ç‚¹æ¨¡æ‹Ÿçš„ç™½å­ã€é»‘å­çš„èƒœåˆ©æ¬¡æ•°(defaultdict: å½“å­—å…¸é‡Œçš„keyä¸å­˜åœ¨ä½†è¢«æŸ¥æ‰¾æ—¶ï¼Œè¿”å›0)
</code></pre></div></div>

<p><br /></p>

<p>ä»…æœ‰æ•°æ®ç»“æ„æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œè¿˜éœ€è¦å®šä¹‰ä¸€å¥—åŠ¨ä½œæ¥å®ç°è¿™äº›è¿‡ç¨‹ï¼š<br />
<code class="language-plaintext highlighter-rouge">fully_expanded(self)</code>ï¼šåˆ¤æ–­ç»“ç‚¹æ˜¯å¦å®Œå…¨æ‰©å±•ã€‚<br />
<code class="language-plaintext highlighter-rouge">non_terminal(self)</code>ï¼šåˆ¤æ–­ç»“ç‚¹æ˜¯å¦ä¸ºç»ˆç«¯å¶å­ç»“ç‚¹ï¼Œå³è¯¥èŠ‚ç‚¹å¯¹åº”çš„æ ¼å±€æ˜¯å¦å·²åˆ†å‡ºèƒœè´Ÿã€‚<br />
<code class="language-plaintext highlighter-rouge">pick_univisted(self)</code>ï¼šé€‰æ‹©ä¸€ä¸ªæœªè®¿é—®çš„ç»“ç‚¹å¹¶å°†å…¶æ·»åŠ è¿›å½“å‰ç»“ç‚¹çš„å­©å­ä¸­ã€‚<br />
<code class="language-plaintext highlighter-rouge">pick_random(self)</code>ï¼šéšæœºé€‰æ‹©è¯¥èŠ‚ç‚¹çš„ä¸€ä¸ªå­©å­è¿›è¡Œæ‰©å±•ã€‚<br />
<code class="language-plaintext highlighter-rouge">num_of_win(self)</code>ï¼šåˆ¤æ–­è¯¥èŠ‚ç‚¹çš„èƒœè´Ÿæƒ…å†µï¼Œåˆ©ç”¨ä¸€ä¸ªå®æ•°å³å¯ä»£è¡¨é»‘ç™½äºŒå­çš„èƒœè´Ÿå·®å€¼ã€‚<br />
<code class="language-plaintext highlighter-rouge">best_uct(self, c_param=1.98)</code>ï¼šUCTæ¯”è¾ƒè¿‡ç¨‹ï¼Œé€‰æ‹©å½“å‰ç­–ç•¥ä¸‹æœ€ä¼˜çš„å­©å­ç»“ç‚¹ï¼Œå¯è°ƒèŠ‚å‚æ•°ï¼Œä¾æ®çš„å…¬å¼ä¸º:<br /></p>
<pre><code class="language-math">\frac{w_i}{n_i} + c \sqrt{\frac{ln t}{n_i}} 

</code></pre>
<pre><code class="language-math">w_{i}ä»£è¡¨ç¬¬iæ¬¡ç§»åŠ¨åå–èƒœçš„æ¬¡æ•°ï¼›

</code></pre>

<pre><code class="language-math">n_iä»£è¡¨ç¬¬iæ¬¡ç§»åŠ¨åä»¿çœŸçš„æ¬¡æ•°ï¼›
</code></pre>

<pre><code class="language-math">cä¸ºæ¢ç´¢å‚æ•°â€”ç†è®ºä¸Šç­‰äº\sqrt {2}ï¼›åœ¨å®é™…ä¸­é€šå¸¸å¯å‡­ç»éªŒé€‰æ‹©ï¼›
</code></pre>

<pre><code class="language-math">tä»£è¡¨ä»¿çœŸæ€»æ¬¡æ•°ï¼Œç­‰äºæ‰€æœ‰n_içš„å’Œã€‚
</code></pre>

<p><br /><br /></p>

<p><em>å‡½æ•°ä»£ç é™„åœ¨åšå®¢ç»“å°¾å¤„ã€‚</em></p>

<p><br /></p>

<p>æ¥ä¸‹æ¥å°±å¯ä»¥åŸºäºè¿™äº›çš„åŠ¨ä½œï¼Œç€æ‰‹è¿›è¡Œè’™ç‰¹å¡æ´›æ ‘æœç´¢çš„ç¼–å†™äº†ã€‚</p>
<h3 id="é€‰æ‹©selection">é€‰æ‹©ï¼ˆSelectionï¼‰</h3>
<p>é€‰æ‹©æ“ä½œï¼Œå³ä»æ ¹èŠ‚ç‚¹Rå¼€å§‹ï¼Œè¿ç»­å‘ä¸‹é€‰æ‹©å­èŠ‚ç‚¹è‡³å¶å­èŠ‚ç‚¹Lã€‚åˆ©ç”¨<code class="language-plaintext highlighter-rouge">best_uct</code>æ–¹æ³•ï¼Œè®©æ¸¸æˆæ ‘å‘æœ€ä¼˜çš„æ–¹å‘æ‰©å±•ï¼Œè¿™æ˜¯è’™ç‰¹å¡æ´›æ ‘æœç´¢çš„ç²¾è¦æ‰€åœ¨ã€‚ <br /> 
è¿™ä¸€æ­¥çš„æ“ä½œå¦‚å›¾æ‰€ç¤ºï¼ˆç®­å¤´ä»£è¡¨è¿™ä¸€æ­¥çš„æ“ä½œï¼‰ï¼š</p>

<p><img src="http://commcheck396.github.io/assets/img/2022_1_20/selection.svg.png" alt="pic from internet" /></p>

<h3 id="æ‰©å±•expansion">æ‰©å±•ï¼ˆExpansionï¼‰</h3>
<p>æ‰©å±•æ“ä½œï¼Œå³é™¤éä»»æ„ä¸€æ–¹çš„è¾“èµ¢ä½¿å¾—æ¸¸æˆåœ¨Lç»“æŸï¼Œå¦åˆ™åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªå­èŠ‚ç‚¹å¹¶é€‰å–å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹Cã€‚  <br />
è¿™ä¸€æ­¥çš„æ“ä½œå¦‚å›¾æ‰€ç¤ºï¼ˆç®­å¤´ä»£è¡¨è¿™ä¸€æ­¥çš„æ“ä½œï¼‰ï¼š</p>

<p><img src="http://commcheck396.github.io/assets/img/2022_1_20/expansion.svg.png" alt="pic from internet" /></p>

<h3 id="ä»¿çœŸsimulation">ä»¿çœŸï¼ˆSimulationï¼‰</h3>
<p>ä»¿çœŸæ“ä½œï¼Œå³åœ¨ä»èŠ‚ç‚¹Cå¼€å§‹ï¼Œç”¨éšæœºç­–ç•¥è¿›è¡Œæ¸¸æˆï¼Œåˆç§°ä¸ºplayoutæˆ–è€…rolloutï¼Œç›´è‡³æ ¼å±€è¾¾åˆ°ç»ˆç›˜ï¼Œæ¸¸æˆç»“æŸï¼Œäº§ç”Ÿèƒœè´Ÿã€‚<br />
è¿™ä¸€æ­¥çš„æ“ä½œå¦‚å›¾æ‰€ç¤ºï¼ˆç®­å¤´ä»£è¡¨è¿™ä¸€æ­¥çš„æ“ä½œï¼‰ï¼š</p>

<p><img src="http://commcheck396.github.io/assets/img/2022_1_20/simulation.svg.png" alt="pic from internet" /></p>

<h3 id="åå‘ä¼ æ’­backpropagation">åå‘ä¼ æ’­ï¼ˆBackpropagationï¼‰</h3>
<p>åå‘ä¼ æ’­æ“ä½œï¼Œå³ä½¿ç”¨ä¸Šä¸€æ­¥ä»¿çœŸéšæœºæ¸¸æˆçš„ç»“æœï¼Œæ›´æ–°ä»Cåˆ°Rçš„è·¯å¾„ä¸Šçš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œæ›´æ–°æ¯ä¸ªç»“ç‚¹çš„èƒœè´Ÿå€¼ä»¥åŠæ€»ç›˜æ•°ã€‚<br />
è¿™ä¸€æ­¥çš„æ“ä½œå¦‚å›¾æ‰€ç¤ºï¼ˆç®­å¤´ä»£è¡¨è¿™ä¸€æ­¥çš„æ“ä½œï¼‰ï¼š</p>

<p><img src="http://commcheck396.github.io/assets/img/2022_1_20/backpropagation.svg.png" alt="pic from internet" /></p>

<p><em>æ’å›¾ä¸­èŠ‚ç‚¹å†…çš„å†…å®¹ä»£è¡¨èƒœåˆ©æ¬¡æ•°/æ¸¸æˆæ¬¡æ•°ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨è¿™ä¸ªå‚æ•°æ¥å¯»æ‰¾ä¸‹ä¸€æ­¥çš„æœ€ä¼˜çš„è¡Œæ£‹ä½ç½®ã€‚</em></p>

<p><br /></p>

<p>æ ¹æ®ä¸Šè¿°å››ä¸ªæ­¥éª¤ï¼Œç¼–å†™å‡½æ•°å®ç°è¯¥åŠŸèƒ½ï¼š<br />
<code class="language-plaintext highlighter-rouge">traverse(node)</code>ï¼šéå†ç»“ç‚¹ï¼Œé‡åˆ°å·²å®Œå…¨å±•å¼€çš„ç»“ç‚¹ï¼Œåˆ©ç”¨<code class="language-plaintext highlighter-rouge">best_uct</code>é€‰æ‹©æœ€ä½³çš„å­©å­èŠ‚ç‚¹ç»§ç»­å‘ä¸‹éå†ã€‚æ­¤å‡½æ•°å®ç°é€‰æ‹©+æ‹“å±•è¿‡ç¨‹ã€‚<br />
<code class="language-plaintext highlighter-rouge">rollout(node)</code>ï¼šä»¿çœŸè¿‡ç¨‹ï¼Œä¸æ–­åˆ©ç”¨<code class="language-plaintext highlighter-rouge">pick_random()</code>éšæœºé€‰æ‹©ç»“ç‚¹ï¼Œç›´è‡³å†³å‡ºèƒœè´Ÿï¼Œè¿”å›èƒœè´Ÿå€¼ã€‚<br />
<code class="language-plaintext highlighter-rouge">backpropagate(node, result)</code>ï¼šåå‘ä¼ æ’­è¿‡ç¨‹ï¼Œåˆ©ç”¨<code class="language-plaintext highlighter-rouge">rollout()</code>çš„ç»“æœå‘ä¸Šæ›´æ–°èŠ‚ç‚¹å†…å®¹ã€‚<br />
<code class="language-plaintext highlighter-rouge">best_child(node)</code>ï¼šåˆ©ç”¨æ¯ä¸ªèŠ‚ç‚¹çš„å‚æ•°ï¼ˆèƒœåˆ©æ¬¡æ•°/æ¸¸æˆæ¬¡æ•°ï¼‰æ¥åˆ¤æ–­å“ªä¸€ä¸ªå­©å­æ”¶ç›Šæœ€å¤§ï¼Œå¹¶è¿”å›è¿™ä¸ªå­©å­ã€‚<br />
<code class="language-plaintext highlighter-rouge">monte_carlo_tree_search(board, pre_pos)</code>ï¼šåˆ©ç”¨ä¸Šæ–¹åŠŸèƒ½ï¼Œå®ç°è’™ç‰¹å¡æ´›æœç´¢ï¼Œé€‰å‡ºæœ€ä¼˜è½å­ä½ç½®ã€‚<br /></p>

<p><br /></p>

<p><em>å‡½æ•°ä»£ç é™„åœ¨åšå®¢ç»“å°¾å¤„ã€‚</em></p>

<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†æœ€åŸºç¡€çš„è’™ç‰¹å¡æ´›æ ‘æœç´¢åŠŸèƒ½ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç”¨æˆ·äº¤äº’ç•Œé¢çš„ç¼–å†™ï¼Œè¿™ä¸€éƒ¨åˆ†å·²ç»ä¸ç®—æ³•æ— å…³ï¼Œä»…éœ€ä¸æ–­è·å–ç”¨æˆ·çš„è½å­ä½ç½®ï¼Œå¹¶é’ˆå¯¹æ¯ä¸€ä¸ªæ£‹ç›˜æ ¼å±€ï¼Œå‡è®¾ç”¨æˆ·ä¼šé€‰æ‹©æœ€æœ‰åˆ©çš„ä½ç½®ï¼Œå¯¹æ¨¡å‹è¿›è¡Œä¸€å®šæ¬¡æ•°çš„è®­ç»ƒï¼Œé’ˆå¯¹è®­ç»ƒç»“æœè®©ç”µè„‘é€‰æ‹©æœ€ä½³çš„è½å­ä½ç½®ã€‚  <br />
ç»åˆæ­¥æµ‹è¯•ï¼Œåœ¨6*6æ£‹ç›˜ä¸Šï¼Œæ¯è½®ç»15000æ¬¡æœç´¢åå¾—åˆ°çš„ç»“æœè¿˜ä¸é”™ï¼Œ<del>èµ·ç ä¸€æ—¶åŠä¼šä¸ä¼šè¾“ğŸ˜‚</del>ã€‚ä½†åœ¨8*8çš„æ£‹ç›˜ä¸Šï¼Œ15000çš„æœç´¢é‡å°±æ˜¾å¾—æœ‰äº›æ‰è¥Ÿè§è‚˜ï¼Œç»“æœä¸æ€ä¹ˆç†æƒ³ã€‚ä½†å—é™äºç”µè„‘ç®—åŠ›ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆç”¨GPUå¯¹è¿™ä¸ªç¨‹åºè¿›è¡Œè¿ç®—ï¼Œå†åŠ å¤§æœç´¢é‡ï¼Œæ¯æ¬¡è¡Œæ£‹éƒ½è¦ç­‰å¾…å¥½é•¿æ—¶é—´ï¼Œç›®å‰å°±å…ˆè¿™æ ·å§ï¼Œå…³äºç”¨æˆ·äº¤äº’çš„éƒ¨åˆ†æ”¾åˆ°ä¸‹ä¸€ç¯‡åšå®¢å§ï¼Œ<del>æœ‰æ—¶é—´å°±å†™ä¸€ä¸ªGUIğŸ¥±</del>ã€‚</p>

<p><em>*å›¾ç‰‡æ¥è‡ªÂ©ç»´åŸºç™¾ç§‘</em></p>

<p><br /><br /><br /><br /></p>
<h3 id="å‚è€ƒä»£ç ">å‚è€ƒä»£ç ï¼š</h3>
<p>ç»“ç‚¹éƒ¨åˆ†ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fully_expanded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">not_visit_pos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>     
        <span class="bp">self</span><span class="p">.</span><span class="n">not_visit_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">board</span><span class="p">.</span><span class="n">get_legal_pos</span><span class="p">()</span>    
    <span class="k">return</span> <span class="bp">True</span> <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">not_visit_pos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">children</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">pick_univisted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">not_visit_pos</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>    
    <span class="n">move_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">not_visit_pos</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="n">random_index</span><span class="p">)</span>  


    <span class="n">new_board</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">board</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">move_pos</span><span class="p">)</span>  
    <span class="n">new_node</span> <span class="o">=</span> <span class="n">TreeNode</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre_pos</span><span class="o">=</span><span class="n">move_pos</span><span class="p">,</span> <span class="n">board</span><span class="o">=</span><span class="n">new_board</span><span class="p">)</span> 
    <span class="bp">self</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_node</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_node</span>

<span class="k">def</span> <span class="nf">pick_random</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">possible_moves</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">board</span><span class="p">.</span><span class="n">get_legal_pos</span><span class="p">()</span>  
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">possible_moves</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>   
    <span class="n">move_pos</span> <span class="o">=</span> <span class="n">possible_moves</span><span class="p">[</span><span class="n">random_index</span><span class="p">]</span>

    <span class="n">new_board</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">board</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">move_pos</span><span class="p">)</span>
    <span class="n">new_node</span> <span class="o">=</span> <span class="n">TreeNode</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre_pos</span><span class="o">=</span><span class="n">move_pos</span><span class="p">,</span> <span class="n">board</span><span class="o">=</span><span class="n">new_board</span><span class="p">)</span>  
    <span class="k">return</span> <span class="n">new_node</span>

<span class="k">def</span> <span class="nf">non_terminal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">game_result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">board</span><span class="p">.</span><span class="n">game_over</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">pre_pos</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">game_result</span>

<span class="k">def</span> <span class="nf">num_of_win</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">wins</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">num_of_wins</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">board</span><span class="p">.</span><span class="n">cur_player</span><span class="p">]</span> 
    <span class="n">loses</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">num_of_wins</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">board</span><span class="p">.</span><span class="n">cur_player</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">wins</span> <span class="o">-</span> <span class="n">loses</span>

<span class="k">def</span> <span class="nf">best_uct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c_param</span><span class="o">=</span><span class="mf">1.98</span><span class="p">):</span>
    <span class="n">uct_of_children</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">([</span>
        <span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">num_of_win</span><span class="p">()</span> <span class="o">/</span> <span class="n">child</span><span class="p">.</span><span class="n">num_of_visit</span><span class="p">)</span> <span class="o">+</span> <span class="n">c_param</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">num_of_visit</span><span class="p">)</span> <span class="o">/</span> <span class="n">child</span><span class="p">.</span><span class="n">num_of_visit</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">children</span>
    <span class="p">]))</span>
    <span class="n">best_index</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">uct_of_children</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="n">best_index</span><span class="p">]</span>
</code></pre></div></div>

<p>è’™ç‰¹å¡æ´›æ ‘æœç´¢éƒ¨åˆ†ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
def monte_carlo_tree_search(board, pre_pos):
    root = TreeNode(board=board, pre_pos=pre_pos)  
    for i in range(0,mcts_times):  
        leaf = traverse(root) 
        simulation_result = rollout(leaf) 
        backpropagate(leaf, simulation_result)  
    return best_child(root).pre_pos


def traverse(node):
    while node.fully_expanded():  
        node = node.best_uct()
    if node.non_terminal() is not None:    
        return node
    else:    
        return node.pick_univisted()   


def rollout(node):
    while True:
        game_result = node.non_terminal()
        if game_result is None:  
            node = node.pick_random() 
        else: 
            break
    if game_result == 'win' and -node.board.cur_player == 1: 
        return 1     
    elif game_result == 'win':    
        return -1   
    else: 
        return 0


def backpropagate(node, result):
    node.num_of_visit += 1
    node.num_of_wins[result] += 1
    if node.parent: 
        backpropagate(node.parent, result)


def best_child(node):
    visit_num_of_children = np.array(list([child.num_of_visit for child in node.children]))
    best_index = np.argmax(visit_num_of_children)
    node = node.children[best_index]
    return node

</code></pre></div></div>
:ET